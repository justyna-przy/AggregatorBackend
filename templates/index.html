<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Elevator MQTT Feed</title>
    <link rel="stylesheet" href="/static/styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Bitcount+Grid+Double+Ink:wght@100..900&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <header>
      <h1>Elevator MQTT Feed</h1>
      <p>Live updates from the ESP</p>
    </header>
    <main>
    <div class="toolbar">
      <button id="panic-btn" class="panic-btn">
        <img src="/static/assets/emergency-button.jpg" alt="Emergency Stop Button" />
      </button>
    </div>

      <h2>Recent Messages</h2>
      <ul id="messages"></ul>

      <h2>Console</h2>
      <div class="console" id="console"></div>
    </main>

    <script>
      const consoleEl = document.getElementById("console");

      function log(msg) {
        const ts = new Date().toLocaleTimeString();
        consoleEl.textContent = `[${ts}] ${msg}\n` + consoleEl.textContent;
      }

      async function loadMessages() {
        try {
          const res = await fetch("/api/messages");
          const data = await res.json();
          const list = document.getElementById("messages");
          list.innerHTML = data
            .map((m) => `<li><strong>${m.topic}</strong>: ${m.payload}</li>`)
            .join("");
          log(`Loaded ${data.length} messages`);
        } catch (err) {
          console.error(err);
          log(`Error: ${err.message}`);
        }
      }

      document.getElementById("panic-btn").addEventListener("click", () => {
        log("Emergency Stop button pressed (hook backend publish here)");
        // TODO: POST to backend endpoint to publish MQTT command when implemented
      });

      loadMessages();
      setInterval(loadMessages, 100000);
    </script>
  </body>
</html>
